<app-alerts></app-alerts>
<div class="flex-grow flex flex-col w-full max-h-screen min-w-screen  lg:flex-row bg-white p-0 m-0">
  <!-- Modal container -->
  <dialog id="animalCreateModal" class="modal modal-bottom sm:modal-middle">
    >
    <div class="modal-box">
      <h2 class="text-2xl font-bold text-center mb-4 text-black" id="modal-title">
        {{ selectedAnimal ? 'Edit Animal' : 'Add New Animal' }}
      </h2>

      <form [formGroup]="animalCreateForm"
            (ngSubmit)="addAnimalToCollection(); closeModal();"
            class="w-full" method="dialog">
        
        <!-- Animal Name -->
        <div class="form-control w-full">
          <label for="animalName" class="label">
            <span class="label-text">Animal Name</span>
          </label>
          <input type="text"
                 id="animalName"
                 formControlName="animalName"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Owner Name -->
        <div class="form-control w-full">
          <label for="ownerName" class="label">
            <span class="label-text">Owner Name</span>
          </label>
          <input type="text"
                 id="ownerName"
                 formControlName="ownerName"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Animal Type -->
        <div class="form-control w-full">
          <label for="animalType" class="label">
            <span class="label-text">Animal Type</span>
          </label>
          <input type="text"
                 id="animalType"
                 formControlName="animalType"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Animal Breed -->
        <div class="form-control w-full">
          <label for="animalBreed" class="label">
            <span class="label-text">Animal Breed</span>
          </label>
          <input type="text"
                 id="animalBreed"
                 formControlName="animalBreed"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Color -->
        <div class="form-control w-full">
          <label for="color" class="label">
            <span class="label-text">Color</span>
          </label>
          <input type="text"
                 id="color"
                 formControlName="color"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Animal Weight -->
        <div class="form-control w-full">
          <label for="animalWeight" class="label">
            <span class="label-text">Animal Weight (lbs)</span>
          </label>
          <input type="number"
                 step="0.01"
                 id="animalWeight"
                 formControlName="animalWeight"
                 class="input input-bordered w-full text-black"
                 required />
        </div>
        <!-- Animal Sex -->
        <div class="form-control w-full">
          <label for="animalSex" class="label">
            <span class="label-text">Animal Sex</span>
          </label>
          <div class="radio-input">
            <input type="radio" id="male" formControlName="animalSex" value="Male">
            <div class="radio-label">
              <label for="male">Male</label>
            </div>
            <div class="radio-input">
              <input type="radio" id="female" formControlName="animalSex" value="Female">
            </div>
            <div class="radio-label">
              <label for="female">Female</label>
            </div>
          </div>
          </div>
          <!-- Temperament -->
          <div class="form-control w-full">
            <label for="temperament" class="label">
              <span class="label-text">Temperament</span>
            </label>
            <input type="text"
                   id="temperament"
                   formControlName="temperament"
                   class="input input-bordered w-full text-black"
                   required />
          </div>
          <!-- About -->
          <div class="form-control w-full">
            <label for="about" class="label">
              <span class="label-text">About</span>
            </label>
            <textarea id="about"
                      formControlName="about"
                      class="textarea textarea-bordered w-full text-black"
                      required></textarea>
          </div>
          <!-- Primary Image -->
          <div class="form-control w-full">
            <label for="primaryImage" class="label">
              <span class="label-text">Primary Image</span>
            </label>
            <div class="avatar rounded">
              <figure class="w-20 h-20 rounded-full">
                <img [src]="imgUrl" alt="Animal Photo">
              </figure>
            </div>
            <input type="file" class="file-input w-full max-w-xs" id="imageUpload" hidden (change)="updatePhoto($event)" required />
            <div class="max-w-xs flex flex-row mt-2">
              <label for="imageUpload" class="btn btn-secondary">Upload Image</label>
            </div>
          </div>
          <!-- Location -->
          <div class="form-control w-full">
            <label for="location" class="label">
              <span class="label-text">Location</span>
            </label>
            <input type="text"
                   id="location"
                   formControlName="location"
                   class="input input-bordered w-full text-black"
                   required />
          </div>
          <!-- Zip Code -->
          <div class="form-control w-full">
            <label for="zipCode" class="label">
              <span class="label-text">Zip Code</span>
            </label>
            <input type="number"
                   id="zipCode"
                   formControlName="zipCode"
                   class="input input-bordered w-full text-black"
                   required />
          </div>
          <!-- Adoption Status -->
          <div class="form-control w-full">
            <label for="adoptionStatus" class="label">
              <span class="label-text">Adoption Status</span>
            </label>
            <input type="number"
                   id="adoptionStatus"
                   formControlName="adoptionStatus"
                   class="input input-bordered w-full text-black"
                   required />
          </div>
          <!-- Date Of Birth -->
          <div class="form-control w-full">
            <label for="dateOfBirth" class="label">
              <span class="label-text">Date Of Birth</span>
            </label>
            <input type="date"
                   id="dateOfBirth"
                   formControlName="dateOfBirth"
                   class="input input-bordered w-full text-black"
                   required />
          </div>
          <!-- Vaccination Status -->
          <div class="form-control w-full">
            <label for="vaccinationStatus" class="label">
              <span class="label-text">Vaccination Status</span>
            </label>
            <input type="text"
                   id="vaccinationStatus"
                   formControlName="vaccinationStatus"
                   class="input input-bordered w-full text-black"
                   required />
          </div>

          <div class="modal-action">
            <button class="btn btn-primary" type="submit" [disabled]="!animalCreateForm.valid">
              {{ selectedAnimal ? 'Update' : 'Add Animal' }}
            </button>
            <button class="btn btn-accent" onclick="animalCreateForm.close()">Cancel</button>
          </div>
</form>
    </div>
  </dialog>

  <!-- Sidebar -->
  <div class="w-1/4 h-dvh flex flex-col overflow-y-auto no-scrollbar bg-white">
    <div class="w-full h-7/8 bg-white flex flex-col">
      <h2 class="text-left justify-between w-full flex items-center gap-4 p-4">Explore</h2>
    </div>
    <div class="bg-base-200 p-4 flex flex-col items-center">
      <!-- Animal Type dropdown -->
      <select #animalTypeSelect (change)="dropdownFilter($event, animalTypeSelect.value, 'type')" class="form-select w-full m-2 max-w-xs px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        <option value="">Select Animal Type</option>
        <option *ngFor="let type of uniqueTypes" [value]="type">{{type}}</option>
      </select>
      <!-- Animal Breed dropdown-->
      <select #animalBreedSelect (change)="dropdownFilter($event, animalBreedSelect.value, 'breed')" class="form-select w-full max-w-xs px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        <option value="">Select Animal Breed</option>
        <option *ngFor="let type of uniqueBreeds" [value]="type">{{type}}</option>
      </select>
      <!-- Clear filters button -->
      <button class="btn btn-secondary m-2" (click)="clearDropdownFilters()">Clear Filters</button>
    </div>
  </div>

  <!-- Divider -->
  <div class="divider lg:divider-horizontal"></div>

  <!-- Profile Tab Content -->
  <div class="w-full h-dvh flex flex-col bg-base-200">
    <div class="flex justify-between items-center p-4 h-1/8 w-full bg-white">
      <div class="flex justify-between items-center w-1/2">
        <button class="btn btn-secondary" onclick="animalCreateModal.show()" (click)="this.createNewSetup();">
          Create
        </button>
      </div>
      <div class="flex justify-between items-center w-1/2">
        <input #searchInput
               type="text"
               placeholder="Search animals..."
               class="py-2 px-3 border border-gray-300 rounded-s shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm w-full mr-2 ml-2"
               (input)="searchFunction($event)" />
        <button class="btn btn-primary" (click)="filterThreads(searchInput.value)">
          Search
        </button>
      </div>
    </div>

    <div class="w-full h-full flex flex-col bg-base-200">
      <div class="grid grid-rows-2 grid-cols-4 items-center gap-y-2 overflow-hidden">
        <div *ngFor="let animal of getDisplayedCards()"
             class="card bg-white overflow-hidden m-2 h-6/7 auto-rows-auto">
          <img class="w-full h-48 object-cover"
               [src]="animal.images"
               [alt]="animal.animalName" />
          <div class="p-4">
            <div class="font-bold mb-2">{{ animal.animalName }}</div>
            <div class="mb-2 owner-name"> Owner: {{ animal.ownerName }} </div>
            <div class="mb-2 animal-type"> Type: {{ animal.animalType }} </div>
            <div class="mb-2 animal-breed"> Breed: {{ animal.animalBreed }} </div>
            <!-- More Info Button -->
            <button class="absolute bottom-2 right-2 btn btn-primary text-sm px-2 py-1" (click)="openPetModal(animal)">More info</button>
            <!-- Dropdown Menu -->
            <div class="absolute right-0 top-0">
              <button tabindex="0"
                      class="btn btn-ghost mt-1 mr-1"
                      (click)="toggleDropdown(animal.animalId)"
                      [disabled]="this.loginRegService.userData.userId !== animal.userId">

                &#x22EE;
              </button>
              <ul *ngIf="dropdownVisible === animal.animalId"
                  class="dropdown-content z-[20] menu p-2 shadow bg-white rounded-box w-52">
                <div class="edit-button items-center justify-center">
                  <button class="btn btn-ghost w-full text-center"
                          onclick="animalCreateModal.show()"
                          (click)="editAnimal(animal)">
                    Edit
                  </button>
                </div>
                <div class="edit-button items-center justify-center">
                  <button class="btn btn-ghost w-full text-center"
                          (click)="deleteAnimalFromCollection(animal); toggleDropdown(animal.animalId)">
                    Delete
                  </button>
                </div>
              </ul>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="flex h-1/8 h-20 justify-center items-center bg-white ">
      <nav aria-label="Pagination">
        <ul class="flex">
          <li>
            <a class="btn btn-sm btn-neutral"
               [class.btn-disabled]="currentPage === 1"
               (click)="previousPage()">
              Previous
            </a>
          </li>
          <li *ngFor="let page of getVisiblePages()">
            <a class="btn btn-sm"
               [class.btn-active]="currentPage === page"
               (click)="goToPage(page)">
              {{ page }}
            </a>
          </li>
          <li>
            <a class="btn btn-sm btn-neutral"
               [class.btn-disabled]="currentPage === gettotalPages()"
               (click)="nextPage()">
              Next
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
<!-- Modal for pet info when clicking on a pet posting-->
<dialog #petModal id="petModal" class="modal">
  <div class="modal-box" style="position: relative;">
    <form method="dialog" class="flex flex-row justify-between">
      <h2 class="text-xl font-bold">{{ modalAnimal?.animalName }}</h2>
      <button class="btn btn-neutral">Close</button>
    </form>
    <p>Owner: {{ modalAnimal?.ownerName }}</p>
    <p>Type: {{ modalAnimal?.animalType }}</p>
    <p>Breed: {{ modalAnimal?.animalBreed }}</p>
    <p>Gender: {{ modalAnimal?.animalSex }}</p>
    <p>Weight: {{ modalAnimal?.animalWeight }}</p>
    <p>Temperament: {{ modalAnimal?.temperament }}</p>
    <button class="btn btn-secondary" (click)="this.sendNotification();">Interested? Notify Owner</button>
  </div>
</dialog>

